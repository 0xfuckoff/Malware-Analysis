def encrypt(data):
    key = 'I0L0v3Y0u0V1rUs'
    decrypt = ''
    for d in data:
        for k in key:
            d = chr(ord(d) ^ ord(k))
        d = chr((~ord(d)) & 0xFF)
        decrypt += d
    return decrypt

def decrypt(data):
    return encrypt(data)

def decrypt_string(addr):
    data = get_string(addr)
    return decrypt(data.decode('latin-1'))

def get_string(addr):
    data = bytes()
    for lcount in range(500):
        b = get_bytes(addr, 1)
        if ord(b) == 0:
            break
        data += b
        addr += 1
    return data

def is_ascii(s):
    return all(ord(c) < 128 for c in s)

def replace_string(addr, str):
    ea = addr
    for s in str:
        patch_byte(addr, ord(s))
        addr += 1
    create_strlit(ea, idc.BADADDR)

def patch_str_tbl(star_ea, end_ea):
    while start_ea <= end_ea:
        b = get_bytes(start_ea, 1)
        if ord(b) == 0:
            start_ea += 1
            continue
        new_str = decrypt_string(start_ea)
        if is_ascii(new_str):
            replace_string(start_ea, new_str)
        start_ea += len(new_str)

start_ea = 0x004053A4
end_ea = 0x00405A74

patch_str_tbl(start_ea, end_ea)

print("Decrypted and Patched all strings in table")
